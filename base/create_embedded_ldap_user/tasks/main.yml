# Role to create a user in the embedded ldap directory
#
# Example:
#   - name: Create easuser in the embedded ldap
#     tags: ["oauth"]
#     include_role:
#       name: base/create_embedded_ldap_user
#     vars:
#       embeddedldap_user_username: "easuser"
#       embeddedldap_user_password: "{{ vault_easuser_password }}"
#
- name: Create Embedded Ldap User
  isam:
    appliance: "{{ inventory_hostname }}"
    adminProxyProtocol: "{{ adminProxyProtocol | default(omit) }}"
    adminProxyHostname: "{{ adminProxyHostname | default(omit) }}"
    adminProxyPort: "{{ adminProxyPort | default(omit) }}"
    adminProxyApplianceShortName: "{{ adminProxyApplianceShortName | default(omit) }}"
    omitAdminProxy: "{{ omitAdminProxy | default(omit) }}"
    username:  "{{ username }}"
    password:  "{{ password }}"
    lmi_port:  "{{ port | default(omit) }}"
    log:       "{{ log_level | default(omit) }}"
    force:     "{{ force | default(omit) }}"
    action: ibmsecurity.isam.web.embedded_ldap.user.add
    isamapi:
      id: "{{ embeddedldap_user_username }}"
      password: "{{ embeddedldap_user_password }}"
  when: embeddedldap_user_username is defined
  notify: Commit Changes
